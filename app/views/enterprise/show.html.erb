<%= render 'home/navbar' %>

<h1><%= @offer.title %></h1>
<p>Description : <%= @offer.description %><p>
<p>Skills:<p>
<% @offer.skillOffers.each do |skillOffer| %>
  <a href="#" class="badge badge-dark badge-pill"><%= Skill.find(skillOffer.skill_id).name %></a>
<% end %>

<p>Postulants:<p>
<% @offer.applications.each do |application| %>
  <p><%= application.percentage %>% : <%= User.find(application.user_id).name %></p>
  <% if(!application.isAccepted) %>
    <input class="acceptApplicant" type="button" class="btn btn-primary" value="Accept" id="<%= application.user_id %>">
  <% end %>
<% end %>


<p>Suggestions:<p>
<p><% @suggestions.each do |elt| %><p>
  <%= elt[1] %>%
  <a href=<%= "/profil/#{elt[0]}" %>><%= elt[0].name %></a>
<% end %>



<p><a href=<%= "/enterprise/delete/#{@offer.id}" %>>Delete offer</a></p>

<% if (@offer.nbModifications < 2) %>
  <p><a href=<%= "/enterprise/update/#{@offer.id}" %>>Update offer</a></p>
<% else %>
  <p>Can't update anymore<p>
<% end %>

<p><a href=<%= "/chat/#{@offer.id}" %>>Chat</a></p>

<script type="text/javascript">
  $(document).ready(function() {
    $('.acceptSuggestion').click(function(evt) {
      $.post('/enterprise/acceptSuggestion', {
        idAcceptSuggestion: evt.target.id,
        idOffer: <%= @offer.id %>
      },function(response) {
        window.location.href="/enterprise/<%= @offer.id %>";
      });
    });
    $('.acceptApplicant').click(function(evt) {
      $.post('/enterprise/acceptApplicant', {
        idAcceptApplicant: evt.target.id,
        idOffer: <%= @offer.id %>
      },function(response) {
        window.location.href="/enterprise/<%= @offer.id %>";
      });
    });
  });
</script>
